const texts = [
  "Lorem ipsum dolor sit amet consectetur adipisicing elit. Doloribus fuga eveniet iusto ea autem veritatis nisi odio optio provident fugiat excepturi magnam laborum repellat animi, quidem voluptatibus libero, quaerat assumenda incidunt, ex tempora quisquam deserunt! Vero soluta minus quis, eaque quo error inventore facere iure. Vitae cumque, aperiam in hic ipsam eligendi dolor quam facilis quos! Itaque voluptate dolorem commodi incidunt nulla? Exercitationem eveniet numquam nam, maxime earum ab mollitia ea laborum itaque tempore ratione perspiciatis animi veritatis iste corrupti fugit velit deleniti architecto dolore fuga minima hic accusantium. Voluptates iure, accusamus temporibus tenetur laboriosam deserunt iusto vero? Odit alias nisi quia fugit voluptas vel itaque placeat magni qui sint soluta id fuga inventore eaque reiciendis, harum et iste molestias optio corporis, laborum repellendus! Dolorem exercitationem impedit beatae ipsam reprehenderit. Corporis quos nam sapiente quo quia adipisci, voluptatibus animi, ratione rem vel repudiandae minima laudantium omnis modi recusandae officiis dolorum. Deleniti corrupti vel architecto et ex placeat! Perferendis quia consectetur reiciendis odio non animi minus optio veniam aut illo, blanditiis explicabo in fuga ratione. Voluptatum veniam maxime non illo nam impedit aliquam? Recusandae eius, quia incidunt tempore asperiores molestias dolor veritatis iure dolore culpa possimus omnis fuga labore ex adipisci. Consectetur eaque illum optio est maiores tenetur tempora architecto impedit odio! Recusandae, placeat debitis ex ipsum minus temporibus tenetur consequatur sunt eligendi obcaecati, provident id dignissimos nobis, autem vero maiores impedit nisi earum nulla a sint numquam dolor. Quam, minima exercitationem! Doloremque, molestias dolorum repudiandae optio numquam culpa sapiente blanditiis obcaecati laudantium, quidem a laboriosam corrupti omnis vel accusantium maxime suscipit tempora! Iusto ducimus excepturi vel architecto id dolor in autem numquam aliquam assumenda optio magnam eum laudantium quae vero deserunt libero quisquam fugit, earum similique minus beatae. Sequi magni exercitationem cumque neque, molestiae illum tenetur. Dolores ad et reprehenderit.",
  "Lorem ipsum dolor sit amet consectetur adipisicing elit. Aliquid molestiae harum eos, voluptatibus velit natus, ratione tempore dolor dolorum expedita odio eveniet incidunt voluptate asperiores quia alias assumenda nam doloremque tempora aperiam dolores nisi nulla quibusdam? Fugiat ratione, expedita nihil velit nobis neque. Nam expedita rem quam quo itaque iure harum pariatur fugiat eaque in quaerat, repellat voluptatem quae, aut consectetur soluta? Sint nulla ipsum quibusdam. Commodi, error quibusdam? Incidunt quis laboriosam sed. Iure quam quasi fugit, voluptatem minima voluptas enim laborum recusandae delectus autem impedit? Deleniti eos velit blanditiis sunt dignissimos mollitia tempora sit minus! Reprehenderit odio, quam, alias dolorum error deserunt asperiores, ab ea quaerat minima quia soluta. Aliquam beatae laboriosam perspiciatis iure unde hic officiis ipsum, expedita nihil repellat magnam fuga rerum provident earum quae magni excepturi voluptatum temporibus aliquid debitis labore nesciunt corrupti? Consequatur iste mollitia eveniet provident odit, blanditiis cumque esse dolorem in omnis dicta doloremque officia repellat inventore? Ad repudiandae, nobis accusantium molestiae odit minus laborum provident, dolore sit et nisi repellat illo quibusdam harum vitae. Excepturi nihil dolore itaque voluptates necessitatibus dolorem tempore sunt, quos incidunt a suscipit ex, ea obcaecati ipsa vero qui, optio repellendus velit unde. A consequuntur exercitationem tempora mollitia recusandae repellendus iste vero. Error, hic voluptatum dolorem in consectetur placeat. Illum quos optio provident nostrum vero! Ipsa corporis veniam sit obcaecati. Quidem placeat sint voluptates eos libero vitae error facere exercitationem, a mollitia nesciunt praesentium itaque perferendis ab corporis assumenda inventore repellat! Minima dolorum recusandae provident totam mollitia eaque quia amet, maiores sit accusantium ducimus assumenda tempora error magnam natus voluptatem corporis similique. Minus, minima! Nihil fugit facilis eaque porro sed expedita reiciendis modi repellat blanditiis doloribus tempora labore iusto laborum ipsum iure pariatur non sint assumenda quae exercitationem, odit corrupti reprehenderit! Necessitatibus earum reprehenderit perspiciatis, ex nostrum quae.",
  "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Fuga dolores esse recusandae aliquid a eos ipsa tenetur iste doloribus ipsam! Earum modi sit consectetur quam alias labore a nesciunt corporis, incidunt ullam, tempora veritatis totam vitae harum explicabo ad minus magni, soluta similique molestias neque inventore quas? Laboriosam rerum placeat ducimus at, similique nam sed dolorem fuga corporis necessitatibus dolor, sequi soluta modi iusto, atque quisquam architecto cum unde. Repellat, provident praesentium laboriosam maiores optio quo corrupti cumque nihil eius sequi, ratione, consequatur eveniet rem dolorem quas. Ullam laboriosam esse laborum vero tempore cupiditate voluptatum necessitatibus nisi quaerat itaque cumque distinctio veniam, possimus repudiandae temporibus, quam error et? Hic impedit quo minima. Magni qui non voluptates expedita ducimus sequi ipsa cupiditate, commodi recusandae facilis dicta enim laboriosam, culpa facere ipsam modi, aspernatur soluta esse suscipit totam. Repellendus, deleniti odit! Quibusdam nostrum consequatur eaque saepe, animi quidem et rem odit assumenda nemo laudantium eos neque accusantium unde a exercitationem dolorum debitis quos velit. Veniam vero facere dolorum quis obcaecati officiis, adipisci repellendus? Quibusdam, totam consectetur iste eveniet harum perspiciatis rem impedit cupiditate fugit dolor dolore nostrum ullam debitis doloribus soluta ut sapiente numquam incidunt ducimus architecto explicabo, error earum minima! Consequuntur enim cum consectetur sit iure, quis, praesentium sapiente, veniam blanditiis dolore omnis voluptates incidunt. Magnam, voluptate. Corporis accusantium ea deserunt beatae aut consectetur doloribus qui sunt quos ratione nihil pariatur ipsa at non enim, accusamus possimus alias quaerat assumenda vero ipsum similique corrupti dolore? Illo modi animi soluta dolorum, quasi ut molestiae voluptates doloremque tenetur provident dolorem dignissimos ab ad reiciendis a quaerat consectetur! Perferendis ducimus similique veniam debitis laborum vel beatae architecto minus, facilis sequi, neque dolor ut illo repudiandae praesentium inventore libero ea aliquam rerum deleniti impedit repellendus omnis ipsam odit? Eum, fugiat assumenda dignissimos dolorem repudiandae distinctio?",
  "Lorem ipsum dolor sit amet consectetur adipisicing elit. Laboriosam, sunt! Quidem fugiat quibusdam velit iste ullam! Quasi aliquid voluptates rem aliquam qui praesentium perspiciatis illo eveniet. Fugiat voluptate dolores consequuntur saepe exercitationem et aspernatur tempore quos eum obcaecati. Repudiandae ipsum rerum magni, eius, ducimus voluptatem inventore ea repellendus accusantium et expedita tempore, magnam dolor fugiat nesciunt dicta officiis vel doloremque excepturi veniam dignissimos unde saepe! Deleniti dignissimos, animi aliquam dolor sunt nemo quia autem doloribus voluptatem fugiat ipsum voluptas fuga nulla dolores pariatur exercitationem possimus quos veritatis? Modi, deserunt magnam id repudiandae quo adipisci eius natus a, excepturi eveniet delectus repellat debitis dolore eaque consectetur dolorem obcaecati asperiores laborum corporis? Quae sit, earum laudantium explicabo similique quibusdam illum quos quas iure, culpa totam ut ea doloribus accusamus ipsa veritatis aspernatur suscipit deserunt nihil quam ipsum dignissimos eaque in commodi! Magni delectus unde autem dolorum consectetur. Eveniet deleniti illo amet praesentium error tenetur sint quis iusto quaerat esse, voluptatibus nostrum? Reiciendis provident eius mollitia, molestiae reprehenderit tempore eos dolores optio aut totam, dolore perferendis suscipit, doloribus nisi. Asperiores dolores esse quas sequi impedit molestiae minima deserunt, dolore, minus repellendus hic dignissimos cumque ullam odit vitae placeat exercitationem blanditiis obcaecati fuga a, facere omnis quam? Deleniti ex vero eum asperiores soluta ipsam incidunt enim ea! Ipsum quo placeat voluptas atque reiciendis dolor repudiandae, eos itaque ab libero. Tempora corrupti, aliquam, laboriosam dolores illum sint officia, cumque dolorum recusandae voluptas dolore eaque voluptatibus quia tenetur tempore iste incidunt quae excepturi. Aspernatur deserunt sed, impedit architecto quas natus labore cupiditate quaerat tempora pariatur enim magni suscipit adipisci. Iste asperiores voluptate voluptatum in saepe et quae culpa odio. Architecto, nesciunt deserunt? Est, quibusdam et expedita sint iste, tenetur, quae voluptatibus magni nisi quia eum qui architecto deleniti itaque rem sit ipsa eaque exercitationem obcaecati fugiat?",
  "Lorem, ipsum dolor sit amet consectetur adipisicing elit. Laborum, similique itaque. Quae asperiores aliquid eligendi magnam aliquam velit laudantium voluptatibus sit earum, cumque ab tempore doloremque! Delectus iusto nobis eligendi totam ullam dolor veniam, possimus soluta, natus tenetur rem corporis facere optio porro saepe voluptates, id sequi itaque voluptatum mollitia quasi modi animi dolorem asperiores? Sequi consequatur quae maiores ab recusandae est optio, rem pariatur iure illo amet nulla soluta ea adipisci tempore cum excepturi omnis corrupti distinctio vitae! Ab at voluptate, excepturi unde suscipit nemo eos dignissimos aliquam? Similique voluptatem necessitatibus perspiciatis sit, odit, sapiente nisi expedita dolorum eaque incidunt voluptatibus cupiditate ipsum ipsa unde dolorem. Illum accusantium neque laborum ipsam id, aliquam cum totam quia reiciendis rerum accusamus qui sequi omnis error iste reprehenderit magni tempora officia necessitatibus eaque tenetur, quos maxime! Amet ipsam magni corrupti incidunt nemo ea quos, dolor fugiat voluptatem beatae rem quod quis rerum molestias unde repellat aspernatur? Placeat architecto eligendi aliquid id blanditiis et sit quos illo saepe molestias perspiciatis ullam nihil accusamus ipsam aut deleniti nisi impedit itaque, aliquam asperiores reprehenderit soluta sequi eaque fugit. Possimus repellat suscipit facilis cum, impedit quas odit ad laboriosam ducimus iusto, a quidem sed eius voluptatem? Obcaecati culpa quisquam aliquid eveniet suscipit? Sint facilis numquam nisi laborum, ad neque quia rem corporis nulla cum. Obcaecati repellendus beatae cupiditate earum tenetur? Reiciendis magnam vitae labore deserunt error id non molestias ipsam, explicabo sed obcaecati quis dicta quo, libero cum molestiae quam, inventore pariatur hic culpa dignissimos itaque sunt. Tempore harum expedita quidem eaque aperiam ea est animi suscipit, delectus nihil minima, ab non ut dolor aut hic sint, dicta error maxime! Doloribus labore quod nihil aspernatur nisi commodi quam ipsam rerum vitae cupiditate, expedita sunt! Explicabo, voluptatem? Eos tempora repudiandae commodi maxime optio facilis sunt, ab necessitatibus?",
  "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Incidunt placeat quas rem sapiente accusantium minus provident quae quaerat architecto error ea ullam qui suscipit veritatis debitis asperiores nesciunt quo unde et, aperiam doloremque cupiditate delectus consectetur. Vero quae quibusdam praesentium facere, tempora nesciunt odit quam reiciendis nulla, magnam velit dignissimos repudiandae impedit harum, et quo in minima adipisci rem veniam! Soluta enim, in eaque totam nam nisi quas maxime repellendus alias doloremque consectetur, consequuntur accusamus iusto. Autem rerum itaque quibusdam molestiae in placeat rem amet quae labore doloremque necessitatibus vero perferendis totam, eius, iure ducimus beatae nisi sequi tempora earum! Impedit, sed esse! Eveniet mollitia modi tempore repellendus, culpa laudantium ullam nobis eius, rerum quidem, ratione velit neque voluptatum aliquid! Dolorem vitae soluta voluptatum, nesciunt nemo laudantium aspernatur deserunt qui. Commodi ullam natus dolore minima nihil, quas quasi cupiditate consequuntur ipsa quo asperiores rem at placeat illo ducimus quia! Sunt deserunt officiis est voluptate illo mollitia aliquam velit deleniti, non, expedita vel, rem repudiandae saepe quia pariatur iusto itaque fugiat neque esse assumenda incidunt eaque iure nostrum. Consequatur adipisci nihil numquam rem neque animi distinctio, commodi, totam soluta ab officia incidunt corporis quidem doloremque a voluptatibus repellendus dolorem ullam nisi deleniti? Sint, quidem optio earum nihil sapiente sunt distinctio nesciunt itaque sequi ut natus, molestias vero eveniet commodi eum corrupti iure, omnis reprehenderit illo ipsum similique alias ea. Modi quibusdam, laudantium assumenda perferendis ipsam quas eligendi temporibus tenetur maiores non ex error labore aspernatur ea iusto architecto exercitationem obcaecati molestias facilis natus deserunt fuga? Aut mollitia quam, eos magnam, quos molestias ea et quia dolorem maxime quisquam, cumque voluptatum nisi sapiente enim unde eius distinctio tempora voluptates consequuntur alias earum laboriosam eligendi accusamus? Iusto saepe quis sapiente possimus sequi nostrum, ipsa soluta tenetur reprehenderit perspiciatis ipsam veniam assumenda inventore nam.",
];
const lorem = () => {
  return texts[Math.floor(Math.random() * texts.length)];
};

const POSTS_PER_PAGE = 3;

var page = 1;

let buttonPrev = document.getElementById("buttonPrev");
let buttonNext = document.getElementById("buttonNext");
let buttonAdd = document.getElementById("buttonAdd");

let modal = document.getElementById("modal");

let buttonModalCancel = document.getElementById("buttonModalCancel");
let buttonModalSave = document.getElementById("buttonModalSave");

let inputTitle = document.getElementById("inputTitle");
let inputUsername = document.getElementById("inputUsername");
let inputAuthor = document.getElementById("inputAuthor");
let inputDate = document.getElementById("inputDate");
let inputUrl = document.getElementById("inputUrl");
let inputContent = document.getElementById("inputContent");

buttonModalCancel.addEventListener("click", () => {
  modal.classList.add("hidden");
});

buttonPrev.addEventListener("click", () => {
  page -= 1;
  populate();
});
buttonNext.addEventListener("click", () => {
  page += 1;
  populate();
});
buttonAdd.addEventListener("click", () => {
  modal.classList.remove("hidden");
});

function test() {
  console.log("test");
}

const removeFirstParentOfClass = (element, className) => {
  while (element.className != className) {
    element = element.parentElement;
  }
  element.parentElement.removeChild(element);
};

const postTemplate = (
  title,
  img,
  subs = ["test", "more", "extra"],
  content = ""
) => {
  let newPost = document.createElement("div");
  newPost.className = "post";

  let content1 = document.createElement("div");
  content1.className = "content";
  newPost.appendChild(content1);

  let h1 = document.createElement("h1");
  h1.innerText = title;
  content1.appendChild(h1);

  let subHeader = document.createElement("div");
  subHeader.className = "sub-header";
  content1.appendChild(subHeader);

  for (let i = 0; i < subs.length; i++) {
    let newDiv = document.createElement("div");
    newDiv.innerText = subs[i];
    subHeader.appendChild(newDiv);

    if (i != subs.length - 1) {
      let newSep = document.createElement("div");
      newSep.className = "separator";
      newSep.innerText = "●";
      subHeader.appendChild(newSep);
    }
  }

  let editContainer = document.createElement("div");
  editContainer.className = "edit-container";
  newPost.appendChild(editContainer);

  let editButton = document.createElement("button");
  editButton.innerText = "Edit";
  editContainer.appendChild(editButton);

  let deleteButton = document.createElement("button");
  deleteButton.innerText = "Delete";
  deleteButton.addEventListener("click", (e) => {
    removeFirstParentOfClass(e.target, "post");
  });
  editContainer.appendChild(deleteButton);

  let image = document.createElement("img");
  image.setAttribute("src", img);
  image.setAttribute("alt", "image loading or not found");
  newPost.appendChild(image);

  let content2 = document.createElement("div");
  content2.className = "content";
  newPost.appendChild(content2);

  let newP = document.createElement("p");
  newP.innerText = content == "" ? lorem() : content;
  content2.appendChild(newP);

  let posts = document.getElementById("posts");
  posts.appendChild(newPost);

  //   newPost.innerHTML = `
  //     <div class="content">
  //         <h1>
  //             ${title}
  //         </h1>
  //         <div class="sub-header">
  //             <div>Destination Europe</div>
  //             <div class="separator">●</div>
  //             <div>Added by <pre class="black">   Jonathat Mercadona</pre></div>
  //             <div class="separator">●</div>
  //             <div>July 01, 2018</div>
  //         </div>
  //     </div>
  //     <div class="edit-container">
  //             <div>Edit | <button>Delete</button></div>
  //     </div>
  //     <img src="${img}" alt="">
  //     <div class="content">
  //         <p>
  //             ${lorem()}
  //         </p>
  //     </div>
  //     `;
};

function resetInput() {
  inputTitle.value = "";
  inputContent.value = "";
  inputDate.value = "";
  inputTitle.value = "";
  inputUrl.value = "";
  inputUsername.value = "";
}

buttonModalSave.addEventListener("click", () => {
  modal.classList.add("hidden");
  postTemplate(
    inputTitle.value,
    inputUrl.value,
    [inputAuthor.value, inputUsername.value, inputDate.value],
    inputContent.value
  );

  resetInput();
});

async function renderPosts(posts) {
  if (page < 1) {
    console.error("page shouldnt be less than 1");
  }
  if (page > Math.ceil(posts.length / POSTS_PER_PAGE)) {
    console.error("page bigger than max");
  }
  document.documentElement.scrollTop = 0;

  let current_page = page - 1;
  let from = current_page * 3;
  let to = Math.min(from + 3, posts.length);
  let max_page = Math.ceil(posts.length / POSTS_PER_PAGE) - 1;

  buttonPrev.classList.remove("hidden");
  buttonNext.classList.remove("hidden");

  if (current_page == 0) {
    buttonPrev.classList.add("hidden");
  }
  if (current_page == max_page) {
    buttonNext.classList.add("hidden");
  }

  let postsEl = document.getElementById("posts");
  postsEl.innerHTML = "";

  for (let i = from; i < to; i++) {
    let post = posts[i];
    console.log(post);
    let user = post.user;

    let img_url = await fetch("https://picsum.photos/700/300").then(
      (res) => res.url
    );
    postTemplate(post.title, img_url, [user.name, user.website, user.phone]);
  }
}

async function populate() {
  fetch("https://jsonplaceholder.typicode.com/posts")
    .then((res) => res.json())
    .then((posts) => {
      fetch("https://jsonplaceholder.typicode.com/users")
        .then((res) => res.json())
        .then((users) => {
          console.log(users);
          posts = posts.map((post) => {
            return {
              ...post,
              user: users[
                users.indexOf(users.find((u) => u.id === post.userId))
              ],
              comments: [],
            };
          });

          fetch("https://jsonplaceholder.typicode.com/comments")
            .then((res) => res.json())
            .then((comments) => {
              for (let comment of comments) {
                posts[
                  posts.indexOf(posts.find((p) => p.id === comment.postId))
                ].comments.push(comment);
              }

              renderPosts(posts);
            });
        });
    });
}

populate(page);

// postTemplate(
//   "The complete guide to explore Transilvania, with your bike",
//   "bike.jpg",
//   ["Destination Europe", "Added by Jonathat Mercadona", "July 01, 2018"]
// );
// postTemplate("test tile", "bike.jpg");
